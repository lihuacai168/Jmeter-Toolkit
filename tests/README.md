# JMeter Toolkit Test Suite

æœ¬ç›®å½•åŒ…å« JMeter Toolkit çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿ API ç«¯ç‚¹çš„åŠŸèƒ½æ€§ã€å¯é æ€§å’Œæ€§èƒ½ã€‚

## æµ‹è¯•æ–‡ä»¶ç»“æ„

### ğŸ§ª æ ¸å¿ƒæµ‹è¯•æ–‡ä»¶

| æ–‡ä»¶å | æè¿° | æµ‹è¯•æ•°é‡ | æµ‹è¯•ç±»å‹ |
|--------|------|----------|----------|
| `test_api.py` | åŸºç¡€ API ç«¯ç‚¹æµ‹è¯• | 4 | å•å…ƒæµ‹è¯• |
| `test_api_enhanced.py` | å¢å¼ºçš„ API åŠŸèƒ½æµ‹è¯• | - | é›†æˆæµ‹è¯• |
| `test_security.py` | å®‰å…¨ç›¸å…³æµ‹è¯• | - | å®‰å…¨æµ‹è¯• |
| `test_execute_api.py` | **Execute API ä¸“é¡¹æµ‹è¯•** | 19 | å•å…ƒ/é›†æˆæµ‹è¯• |
| `test_integration_execute.py` | **Execute API é›†æˆæµ‹è¯•** | 3 | é›†æˆæµ‹è¯• |
| `test_performance_execute.py` | **Execute API æ€§èƒ½æµ‹è¯•** | 8 | æ€§èƒ½æµ‹è¯• |

### ğŸ”§ é…ç½®æ–‡ä»¶

| æ–‡ä»¶å | æè¿° |
|--------|------|
| `conftest.py` | pytest é…ç½®å’Œæµ‹è¯•è£…ç½® |
| `__init__.py` | æµ‹è¯•åŒ…åˆå§‹åŒ– |
| `../pytest.ini` | pytest å…¨å±€é…ç½® |

## æ–°å¢çš„ Execute API æµ‹è¯•

### ğŸ“‹ `test_execute_api.py` - æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

**æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½ï¼š**

#### ä¸Šä¼ ç›¸å…³æµ‹è¯•
- âœ… `test_upload_valid_jmx_file` - æœ‰æ•ˆ JMX æ–‡ä»¶ä¸Šä¼ 
- âœ… `test_upload_invalid_file_extension` - æ— æ•ˆæ–‡ä»¶æ‰©å±•åå¤„ç†
- âœ… `test_case_insensitive_jmx_extension` - æ–‡ä»¶æ‰©å±•åå¤§å°å†™å¤„ç†

#### æ‰§è¡Œç›¸å…³æµ‹è¯•
- âœ… `test_execute_existing_jmx_file` - æ‰§è¡Œå·²å­˜åœ¨çš„ JMX æ–‡ä»¶
- âœ… `test_execute_nonexistent_jmx_file` - æ‰§è¡Œä¸å­˜åœ¨çš„æ–‡ä»¶
- âœ… `test_execute_missing_file_name` - ç¼ºå°‘æ–‡ä»¶åå‚æ•°
- âœ… `test_execute_invalid_file_name_type` - æ— æ•ˆæ–‡ä»¶åç±»å‹

#### ä¸Šä¼ å¹¶æ‰§è¡Œæµ‹è¯•
- âœ… `test_upload_and_execute_valid_file` - æœ‰æ•ˆæ–‡ä»¶çš„ä¸Šä¼ å¹¶æ‰§è¡Œ
- âœ… `test_upload_and_execute_invalid_file` - æ— æ•ˆæ–‡ä»¶å¤„ç†
- âœ… `test_upload_and_execute_empty_file` - ç©ºæ–‡ä»¶å¤„ç†
- âœ… `test_upload_and_execute_large_file` - å¤§æ–‡ä»¶å¤„ç†

#### å¹¶å‘å’Œåºåˆ—æµ‹è¯•
- âœ… `test_sequential_executions` - è¿ç»­æ‰§è¡Œæµ‹è¯•
- âœ… `test_concurrent_uploads` - å¹¶å‘ä¸Šä¼ æµ‹è¯•

#### ä»»åŠ¡ç®¡ç†æµ‹è¯•
- âœ… `test_get_task_after_execution` - æ‰§è¡Œåä»»åŠ¡æŸ¥è¯¢
- âœ… `test_list_tasks_after_executions` - ä»»åŠ¡åˆ—è¡¨æŸ¥è¯¢

#### é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… `test_error_handling_in_upload_and_execute` - é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… `test_file_cleanup_and_isolation` - æ–‡ä»¶æ¸…ç†å’Œéš”ç¦»

### ğŸ”— `test_integration_execute.py` - é›†æˆæµ‹è¯•

**éœ€è¦çœŸå®æµ‹è¯•æœåŠ¡å™¨è¿è¡Œçš„æµ‹è¯•ï¼š**

- âœ… `test_execute_with_real_jmx_against_test_server` - å¯¹çœŸå®æœåŠ¡å™¨æ‰§è¡Œæµ‹è¯•
- âœ… `test_upload_and_execute_with_real_jmx` - å®Œæ•´çš„ä¸Šä¼ æ‰§è¡Œæµç¨‹
- âœ… `test_end_to_end_workflow` - ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹æµ‹è¯•

**ç‰¹æ®ŠåŠŸèƒ½ï¼š**
- è‡ªåŠ¨å¯åŠ¨ `test_examples/test_server.py`
- éªŒè¯ä¸çœŸå®è¢«æµ‹è¯•æœåŠ¡å™¨çš„äº¤äº’
- æµ‹è¯•å®Œæ•´çš„ JMeter æ‰§è¡Œæµç¨‹

### âš¡ `test_performance_execute.py` - æ€§èƒ½æµ‹è¯•

**æ€§èƒ½æŒ‡æ ‡æµ‹è¯•ï¼š**

- â±ï¸ `test_upload_response_time` - ä¸Šä¼ å“åº”æ—¶é—´ (< 2ç§’)
- â±ï¸ `test_execute_response_time` - æ‰§è¡Œå“åº”æ—¶é—´ (< 1ç§’)
- â±ï¸ `test_upload_and_execute_response_time` - ç»„åˆæ“ä½œå“åº”æ—¶é—´ (< 3ç§’)
- ğŸ”„ `test_concurrent_uploads` - å¹¶å‘ä¸Šä¼ æ€§èƒ½
- ğŸ”„ `test_concurrent_executions` - å¹¶å‘æ‰§è¡Œæ€§èƒ½
- ğŸ“ `test_large_file_upload` - å¤§æ–‡ä»¶ä¸Šä¼ æ€§èƒ½
- ğŸ’¾ `test_memory_usage_multiple_operations` - å†…å­˜ä½¿ç”¨æµ‹è¯•
- ğŸŒ `test_api_endpoint_response_times` - API ç«¯ç‚¹å“åº”æ—¶é—´

## æµ‹è¯•æ ‡è®° (Markers)

```ini
markers =
    slow: æ ‡è®°æ…¢é€Ÿæµ‹è¯•
    integration: æ ‡è®°é›†æˆæµ‹è¯•
    unit: æ ‡è®°å•å…ƒæµ‹è¯•
    performance: æ ‡è®°æ€§èƒ½æµ‹è¯•
    security: æ ‡è®°å®‰å…¨æµ‹è¯•
    api: æ ‡è®° API æµ‹è¯•
```

## è¿è¡Œæµ‹è¯•

### ğŸš€ è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰ Execute API æµ‹è¯•
pytest tests/test_execute_api.py -v

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/test_integration_execute.py -v

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pytest tests/test_performance_execute.py -v -m performance

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v
```

### ğŸ“Š è¿è¡Œå¸¦è¦†ç›–ç‡çš„æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=. --cov-report=html --cov-report=term-missing

# åªè¿è¡Œ Execute API æµ‹è¯•çš„è¦†ç›–ç‡
pytest tests/test_execute_api.py --cov=main --cov-report=term-missing
```

### ğŸ” è¿è¡Œç‰¹å®šç±»å‹çš„æµ‹è¯•

```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
pytest -m unit

# è·³è¿‡æ…¢é€Ÿæµ‹è¯•
pytest -m "not slow"

# åªè¿è¡Œæ€§èƒ½æµ‹è¯•
pytest -m performance

# è¿è¡Œ API ç›¸å…³æµ‹è¯•
pytest -m api
```

## CI/CD é›†æˆ

æµ‹è¯•å·²å®Œå…¨é›†æˆåˆ° GitHub Actions CI/CD æµæ°´çº¿ä¸­ï¼š

### ğŸ“‹ CI æµ‹è¯•æ­¥éª¤

1. **å®‰å…¨æµ‹è¯•** - `test_security.py`
2. **API æµ‹è¯•** - `test_api.py`
3. **å¢å¼º API æµ‹è¯•** - `test_api_enhanced.py`
4. **Execute API æµ‹è¯•** - `test_execute_api.py` â­ (æ–°å¢)
5. **é›†æˆæµ‹è¯•** - `test_integration_execute.py` â­ (æ–°å¢)
6. **æ€§èƒ½æµ‹è¯•** - `test_performance_execute.py` â­ (æ–°å¢)
7. **å®Œæ•´æµ‹è¯•å¥—ä»¶** - æ‰€æœ‰æµ‹è¯• + è¦†ç›–ç‡

### âš™ï¸ CI é…ç½®ç‰¹ç‚¹

- âœ… ä½¿ç”¨ UV åŒ…ç®¡ç†å™¨è¿›è¡Œå¿«é€Ÿä¾èµ–å®‰è£…
- âœ… å¤š Python ç‰ˆæœ¬æµ‹è¯• (3.9, 3.10, 3.11, 3.12)
- âœ… å¹¶è¡Œæµ‹è¯•æ‰§è¡Œæé«˜æ•ˆç‡
- âœ… è¦†ç›–ç‡æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆå’Œä¸Šä¼ 
- âœ… æ€§èƒ½æµ‹è¯•è®¾ç½®ä¸º `continue-on-error: true`

## æµ‹è¯•ç¯å¢ƒé…ç½®

### ğŸ› ï¸ æµ‹è¯•è£…ç½® (Fixtures)

- `client` - FastAPI æµ‹è¯•å®¢æˆ·ç«¯
- `setup_test_env` - æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–
- è‡ªåŠ¨åˆ›å»ºæµ‹è¯•ç›®å½• (`jmx_files`, `jtl_files`, `reports`)
- è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®åº“

### ğŸ”§ ç¯å¢ƒå˜é‡

```bash
DATABASE_URL=sqlite:///./test.db
ENVIRONMENT=testing
DEBUG=true
```

## æµ‹è¯•æ•°æ®

### ğŸ“„ æµ‹è¯• JMX æ–‡ä»¶

æ‰€æœ‰æµ‹è¯•ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„æœ‰æ•ˆ JMX å†…å®¹ï¼ŒåŒ…å«ï¼š

- åŸºæœ¬çš„ TestPlan ç»“æ„
- ç®€å•çš„ ThreadGroup é…ç½®
- HTTPSamplerProxy ç¤ºä¾‹
- æ ‡å‡†çš„ JMeter XML æ ¼å¼

### ğŸ“ æ–‡ä»¶ç®¡ç†

- æµ‹è¯•æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆå’Œæ¸…ç†
- å”¯ä¸€æ–‡ä»¶åé¿å…å†²çª
- è·¯å¾„å’Œæƒé™éªŒè¯

## æ–­è¨€ç­–ç•¥

### âœ… å“åº”éªŒè¯

- HTTP çŠ¶æ€ç æ£€æŸ¥
- JSON å“åº”ç»“æ„éªŒè¯
- ä¸šåŠ¡é€»è¾‘ç»“æœéªŒè¯
- é”™è¯¯æ¶ˆæ¯å‡†ç¡®æ€§æ£€æŸ¥

### ğŸ“‹ æ•°æ®å®Œæ•´æ€§

- æ–‡ä»¶ä¸Šä¼ åçš„å­˜åœ¨æ€§éªŒè¯
- ä»»åŠ¡åˆ›å»ºåçš„çŠ¶æ€æ£€æŸ¥
- ç”Ÿæˆæ–‡ä»¶çš„å†…å®¹å’Œå¤§å°éªŒè¯

### âš¡ æ€§èƒ½è¦æ±‚

- å“åº”æ—¶é—´é˜ˆå€¼æ£€æŸ¥
- å¹¶å‘å¤„ç†èƒ½åŠ›éªŒè¯
- èµ„æºä½¿ç”¨åˆç†æ€§æ£€æŸ¥

## æ•…éšœæ’é™¤

### ğŸ› å¸¸è§æµ‹è¯•å¤±è´¥åŸå› 

1. **æ—¶é—´æˆ³ç›¸å…³å¤±è´¥** - æµ‹è¯•è¿è¡Œå¤ªå¿«å¯¼è‡´æ–‡ä»¶åé‡å¤
   - è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ å°å»¶è¿Ÿæˆ–ä½¿ç”¨æ›´ç²¾ç¡®çš„æ—¶é—´æˆ³

2. **æ–‡ä»¶è·¯å¾„é—®é¢˜** - æµ‹è¯•ç›®å½•æœªæ­£ç¡®åˆ›å»º
   - è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ `conftest.py` ä¸­çš„ç›®å½•åˆ›å»ºé€»è¾‘

3. **ç«¯å£å†²çª** - æµ‹è¯•æœåŠ¡å™¨ç«¯å£è¢«å ç”¨
   - è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æµ‹è¯•å‰æ¸…ç†ç«¯å£æˆ–ä½¿ç”¨éšæœºç«¯å£

4. **æƒé™é—®é¢˜** - æ–‡ä»¶åˆ›å»º/åˆ é™¤æƒé™ä¸è¶³
   - è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æµ‹è¯•ç›®å½•æƒé™

### ğŸ” è°ƒè¯•æŠ€å·§

```bash
# è¯¦ç»†è¾“å‡ºè°ƒè¯•ä¿¡æ¯
pytest tests/test_execute_api.py -v -s

# åœåœ¨ç¬¬ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•
pytest tests/test_execute_api.py -x

# è¿è¡Œç‰¹å®šçš„æµ‹è¯•æ–¹æ³•
pytest tests/test_execute_api.py::TestExecuteAPI::test_upload_valid_jmx_file -v

# æ˜¾ç¤ºæœ¬åœ°å˜é‡
pytest tests/test_execute_api.py --tb=long
```

## è´¡çŒ®æŒ‡å—

### ğŸ“ æ·»åŠ æ–°æµ‹è¯•

1. åœ¨é€‚å½“çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•
2. ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
3. æ·»åŠ é€‚å½“çš„æµ‹è¯•æ ‡è®°
4. ç¡®ä¿æµ‹è¯•å¯ä»¥ç‹¬ç«‹è¿è¡Œ
5. æ·»åŠ å¿…è¦çš„æ–‡æ¡£å­—ç¬¦ä¸²

### ğŸ·ï¸ æµ‹è¯•å‘½åè§„èŒƒ

- `test_åŠŸèƒ½_åœºæ™¯()` - å¦‚ `test_upload_valid_file()`
- ä½¿ç”¨æè¿°æ€§åç§°è¯´æ˜æµ‹è¯•ç›®çš„
- æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡æµ‹è¯•ç±»

### ğŸ“š æ–‡æ¡£è¦æ±‚

- æ¯ä¸ªæµ‹è¯•æ–¹æ³•éƒ½è¦æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- è¯´æ˜æµ‹è¯•çš„ç›®çš„å’Œé¢„æœŸç»“æœ
- è®°å½•ç‰¹æ®Šçš„æµ‹è¯•æ¡ä»¶æˆ–ä¾èµ–

---

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: > 90%
- **é›†æˆæµ‹è¯•è¦†ç›–ç‡**: > 80%
- **å…³é”®è·¯å¾„è¦†ç›–ç‡**: 100%

é€šè¿‡è¿™ä¸ªå…¨é¢çš„æµ‹è¯•å¥—ä»¶ï¼Œæˆ‘ä»¬ç¡®ä¿ JMeter Toolkit çš„ Execute API åŠŸèƒ½ç¨³å®šã€å¯é ä¸”æ€§èƒ½ä¼˜è‰¯ã€‚